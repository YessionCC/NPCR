# NOPC
NOPC improved, implemented by Pytorch

## Abstract
In order to improve temporal stability and reduce overfitting, I improved NOPC by adding multi-layer projection and temporal refine net(the main net structure is roughly the same as the original)

## Get Started
### Dependencies:
- python 3.6
- [pytorch>=1.2](https://pytorch.org/)
- torchvision
- opencv
- [ignite=0.2.0](https://github.com/pytorch/ignite)
- [yacs](https://github.com/rbgirshick/yacs)
- [Antialiased CNNs](https://github.com/adobe/antialiased-cnns)
- [apex](https://github.com/NVIDIA/apex)
- [PCPR](https://github.com/wuminye/PCPR)

### Datasets&Models
You can download [here](https://pan.baidu.com/s/13OSRdVeFRDoPoTUW9bgCKA), extraction code: xc3k. Unzip `datasets.zip` to `datasets/` and `nr_models.zip` to `pretrained/`

## Rendering
Take 'Hair' model as example
- copy and rename `configs/config_Hair.yml` to `pretrained/config.yml`
- copy and rename `ExParamGen/CamPose_Hair.inf` to `pretrained/CamPose.inf`
- copy `datasets/Hair/Intrinsic.inf` to `pretrained/Intrinsic.inf`
- rename `pretrained/nr_model_Hair.pth` to `pretrained/nr_model_0.pth`
- run `tools/render.py`

The project has been configured with Hair model by default 

## Train
Take 'Hair' model as example
- copy and rename `configs/config_Hair.yml` to `configs/config.yml`
- run `tools/train.py`

The checkpoint will be saved in `output/` \
I recommend setting one layer at the beginning of training, increase layers after a period of training 

## Refine
- Configure files as 'Rendering'  
- run `tools/refine.py`

Refine Net will consume a long time and take up a lot of video memory. I recommend targeted refining and using `render.py` preprocessing images to save video memory

## Camera Extrinsics Generator
- copy one extrinsic matric to `ExParamGen/CamPose.inf` 
- run `ExParamGen/exgen.py`

The script will generator camera surrounding extrinsics

## Some Results Display
The picture on the left is generated by my program, and the one on the right is the original paper\
Because GIF is compressed, the display effect may be poor. It is recommended to view the video directly(`./results/*.mp4`)

![compare 1](./results/hair_rot_compare.gif)

![compare 2](./results/wolf_rot_compare.gif)

![compare 3](./results/hair_rot_compare2.gif)
